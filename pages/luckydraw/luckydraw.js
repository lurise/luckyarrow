(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/luckydraw/luckydraw"],{"0049":function(e,t,i){"use strict";(function(e){i("d77f");n(i("66fd"));var t=n(i("826e"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=i,e(t.default)}).call(this,i("a821")["createPage"])},"5d3e":function(e,t,i){},"826e":function(e,t,i){"use strict";i.r(t);var n=i("bffe"),r=i("b1be");for(var o in r)"default"!==o&&function(e){i.d(t,e,(function(){return r[e]}))}(o);i("fcc3");var a,s=i("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"5d3938df",null,!1,n["a"],a);t["default"]=c.exports},b1be:function(e,t,i){"use strict";i.r(t);var n=i("c834"),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},bffe:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={almostLottery:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/almost-lottery/components/almost-lottery/almost-lottery")]).then(i.bind(null,"eb32"))}},r=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.prizeIndex=-1})},o=[]},c834:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(i("a34a")),r=i("2a6d");function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return u(e)||l(e)||c(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"===typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(e,t):void 0}}function l(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function u(e){if(Array.isArray(e))return p(e)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function h(e,t,i,n,r,o,a){try{var s=e[o](a),c=s.value}catch(l){return void i(l)}s.done?t(c):Promise.resolve(c).then(n,r)}function f(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var o=e.apply(t,i);function a(e){h(o,n,r,a,s,"next",e)}function s(e){h(o,n,r,a,s,"throw",e)}a(void 0)}))}}var d=function(){Promise.all([i.e("common/vendor"),i.e("uni_modules/almost-lottery/components/almost-lottery/almost-lottery")]).then(function(){return resolve(i("eb32"))}.bind(null,i)).catch(i.oe)},g={name:"Home",components:{AlmostLottery:d},data:function(){return{isDev:!0,lotteryConfig:{lotterySize:600,actionSize:200},lotteryBg:"/static/lottery-bg.png",actionBg:"/static/action-bg.png",prizeList:[],onStock:!0,prizeIndex:-1,prizeing:!1,onFrontend:!1,prizeWeightMax:0,prizeWeightArr:[],goldCoin:600,freeNum:3,goldNum:20,freeNumDay:3}},computed:{isApple:function(){return"ios"===e.getSystemInfoSync().platform}},methods:{handleInitCanvas:function(){(0,r.clearCacheFile)(),this.prizeList=[],this.getPrizeList()},getPrizeList:function(){var t=this;return f(n.default.mark((function i(){var r,o,s;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e.showLoading({title:"奖品准备中..."}),i.next=3,t.requestApiGetPrizeList();case 3:r=i.sent,console.log("获取奖品列表",r),r.ok?(o=r.data,o.length&&(t.prizeList=o,console.log("已获取到奖品列表数据，开始绘制抽奖转盘"),t.onFrontend&&(t.prizeWeightArr=t.prizeList.map((function(e){return e.prizeWeight})),s=a(t.prizeWeightArr),s.sort((function(e,t){return t-e})),t.prizeWeightMax=t.prizeWeightMax>0?t.prizeWeightMax:s[0]))):(e.hideLoading(),e.showToast({title:"获取奖品失败",mask:!0,icon:"none"}));case 6:case"end":return i.stop()}}),i)})))()},requestApiGetPrizeList:function(){return new Promise((function(e,t){var i=setTimeout((function(){clearTimeout(i),i=null,e({ok:!0,data:[{prizeId:1,prizeName:"0.1元现金",prizeStock:10,prizeWeight:200,prizeImage:"/static/git.png"},{prizeId:2,prizeName:"10元现金",prizeStock:0,prizeWeight:50,prizeImage:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-dc-site/56f085e0-bcfe-11ea-b244-a9f5e5565f30.png"},{prizeId:3,prizeName:"5元话费",prizeStock:1,prizeWeight:80},{prizeId:4,prizeName:"50元现金",prizeStock:0,prizeWeight:10,prizeImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAB2klEQVRIia3Wv09TURjG8U+u2kQZcNENh2ok0cnJ0R+L0RB2g/EvwITEwRgnV0Zx0fAHYBh0khBD4sBAmAgDiwQNg4qwmSBDAYf7Fi+n97al9UlObnvO836f3tO355b2GsAYZrCBPRzGdSPmx8J3YtXwDDsB7TR2wl/rNmAYK13C07ES9W11E9s9BjTHdnBKVf8PAcWgehpwCssF0w/5FzqLgw7AA7zDQ/wqzC8H90jjSeFMYW0Yr8PzALfjOh7z1wve2YTzpLlQw2ay+KZ1N7vS24SziVqGexhKzB07pEJXk/dDwTetdZ9HewwZLWFNw2oyudZjQFNrCW8109pqS32GpPX1TOu586fPkLR+IEMjmbzYZ0ha34Atx/fwW58hXxPeFixo7Yg7PQbcKmEtZFgsMb/C4AkDBuUnQKpFuFZI3cZuvP6C+8g6wDP572O95C4Og49/W/YJl/G5YPqO9yV3dh4f8LMCfhjcI93Afix8xAX5SVx2YBY10yagEdxjmiwY7uISXuIFrlSEPG0TMllWcAbzYViXd0rzeXC6ImSiImA+eKU6h7mCeV/eCBMnCJkLzpHSztnFCJ7L//ZkOFv1iRLtRd1IcLpSHVP4jccVnkexPqXkmd7UX15b7tiz29ReAAAAAElFTkSuQmCC"},{prizeId:5,prizeName:"1卷抽纸",prizeStock:3,prizeWeight:3e3,prizeImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAABCElEQVRoge3YMa4BURSH8Y8o7UAp0WgkotBZwluAfhqlZSgUGr23ENUUCpppJnTswAIUSCaTiziZJ8d9/193zdzrfMltABF5plb+oLscDoAV0Pn8OC/lwDhL0k35QT3wstcIuM61Cj0IhXiNuAvOFwr5SgrxRiHeKMSbhnHfAVgU1i1gajhnBpwK6wnQtgxkDTlmSTq/L7rLYQ9byG+WpLvCOT8YQ6K5WgrxRiHeKMQbhXijEG8U4o1CvIkmxPrDquwMrI37KlFJSJake2BUxVlW0VytaEKsV6t5+8Ohak3rRmtIH9hav/QvRHO1FOKNQrwJheQfn+I9wflCIeNHLzuQc51PRP6rC1ZeIm1I8cC5AAAAAElFTkSuQmCC"},{prizeId:6,prizeName:"0.2元现金",prizeStock:8,prizeWeight:120},{prizeId:7,prizeName:"谢谢参与",prizeStock:100,prizeWeight:1e4},{prizeId:8,prizeName:"100金币",prizeStock:100,prizeWeight:3e3}]})}),200)}))},handleDrawStart:function(){console.log("触发抽奖按钮"),this.prizeing||(this.prizeing=!0,this.freeNum>0||this.goldCoin>=this.goldNum?(this.freeNum>0?this.freeNum--:this.goldCoin>=this.goldNum&&(this.goldCoin-=this.goldNum),this.tryLotteryDraw()):(this.prizeing=!1,e.showModal({title:"金币不足",content:"是否前往赚取金币？",success:function(e){console.log("金币不足",e)}})))},tryLotteryDraw:function(){console.log("旋转开始，获取中奖下标......"),this.onFrontend?this.localGetPrizeIndex():this.remoteGetPrizeIndex()},localGetPrizeIndex:function(){if(console.warn("###当前处于前端控制中奖概率，安全起见，强烈建议由后端控制###"),this.prizeWeightMax&&this.prizeWeightArr.length){console.log("当前权重最大值为 =>",this.prizeWeightMax);var e=Math.ceil(Math.random()*this.prizeWeightMax);console.log("本次权重随机数 =>",e);var t=[];this.prizeList.forEach((function(i){i.prizeWeight>=e&&t.push(i.prizeWeight)})),console.log("tempMaxArrs",t);var i=t.length;if(i)if(t.sort((function(e,t){return e-t})),i>1){for(var n=0,r=0;r<t.length;r++)t[r]===t[0]&&n++;if(1===n)this.prizeIndex=this.prizeWeightArr.indexOf(t[0]);else{var o=t[0],a=[],s={};this.prizeWeightArr.forEach((function(e,t){e===o&&a.push({prizeWeight:e,index:t})})),console.log("sameWeightArr",a),s=a[Math.floor(Math.random()*a.length)],console.log("sameWeightItem",s),this.prizeIndex=s.index}}else this.prizeIndex=this.prizeWeightArr.indexOf(t[0]);console.log("本次抽中奖品 =>",this.prizeList[this.prizeIndex].prizeName),this.onStock&&console.log("本次奖品库存 =>",this.prizeList[this.prizeIndex].prizeStock)}else console.warn("###当前已开启前端控制中奖概率，但是奖品数据列表中的 prizeWeight 参数似乎配置不正确###")},remoteGetPrizeIndex:function(){var e=this;console.warn("###当前处于模拟的请求接口，并返回了中奖信息###");var t=setTimeout((function(){clearTimeout(t),t=null;for(var i=a(e.prizeList),n=Math.floor(Math.random()*i.length+1),r=0;r<i.length;r++){var o=i[r];if(o.prizeId===n){e.prizeIndex=r;break}}console.log("本次抽中奖品 =>",e.prizeList[e.prizeIndex].prizeName),e.onStock&&console.log("本次奖品库存 =>",e.prizeList[e.prizeIndex].prizeStock)}),200)},handleDrawEnd:function(){console.log("旋转结束，执行拿到结果后到逻辑"),this.prizeing=!1;var t=this.prizeList[this.prizeIndex].prizeName,i="";if("谢谢参与"===t)i="很遗憾，没有中奖，请再接再厉！";else if(this.onStock){var n=this.prizeList[this.prizeIndex].prizeStock;i=n?"恭喜您，获得 ".concat(t):"很抱歉，您来晚了，当前奖品 ".concat(t," 已无库存")}else i="恭喜您，获得 ".concat(t," ！");e.showModal({content:i,showCancel:!1})},handleDrawFinish:function(t){console.log("抽奖转盘绘制完成",t);var i=setTimeout((function(){clearTimeout(i),i=null,e.showToast({title:t.msg,mask:!0,icon:"none"})}),50)}},onLoad:function(){this.handleInitCanvas()},onUnload:function(){e.hideLoading()}};t.default=g}).call(this,i("a821")["default"])},fcc3:function(e,t,i){"use strict";var n=i("5d3e"),r=i.n(n);r.a}},[["0049","common/runtime","common/vendor"]]]);